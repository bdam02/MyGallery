<!-- ...Tout le reste du HTML et CSS reste identique... -->

<script>
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const gallery = document.getElementById('gallery');
const fileNameInput = document.getElementById('fileName');
const clearBtn = document.getElementById('clearBtn');
const searchInput = document.getElementById('searchInput');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const closeModal = document.getElementById('closeModal');

let savedFiles = JSON.parse(localStorage.getItem('myGallery') || '[]');

// Charger fichiers existants
savedFiles.forEach(file => addFileCard(file, false));

uploadBtn.addEventListener('click', () => {
  const files = fileInput.files;
  if(files.length === 0) return alert("SÃ©lectionne au moins un fichier !");

  Array.from(files).forEach(file => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const fileURL = e.target.result;
      const chosenName = fileNameInput.value.trim();
      const name = chosenName || file.name;

      const fileData = { name, type: file.type, data: fileURL }; // nom custom ici
      savedFiles.push(fileData);
      localStorage.setItem('myGallery', JSON.stringify(savedFiles));

      addFileCard(fileData, true); // on envoie fileData
    }
    reader.readAsDataURL(file);
  });

  fileInput.value = "";
  fileNameInput.value = "";
});

function addFileCard(fileData, animate=true) {
  const card = document.createElement('div');
  card.classList.add('fileCard');
  if(animate) setTimeout(()=>card.classList.add('show'), 50);
  else card.classList.add('show');

  const nameToShow = fileData.name; // <-- Utiliser le nom du fileData directement

  if(fileData.type.startsWith("image/")) {
    card.innerHTML = `<img src="${fileData.data}" alt="${nameToShow}"><div class="fileName" contenteditable="true">${nameToShow}</div><button class="deleteBtn">&times;</button>`;
  } else if(fileData.type.startsWith("video/")) {
    card.innerHTML = `<video src="${fileData.data}" controls></video><div class="fileName" contenteditable="true">${nameToShow}</div><button class="deleteBtn">&times;</button>`;
  } else {
    card.innerHTML = `<div class="fileName" contenteditable="true">${nameToShow}</div><a href="${fileData.data}" download>Download</a><button class="deleteBtn">&times;</button>`;
  }

  // Modifier le nom directement
  const nameDiv = card.querySelector('.fileName');
  nameDiv.addEventListener('input', () => {
    fileData.name = nameDiv.textContent.trim();
    localStorage.setItem('myGallery', JSON.stringify(savedFiles));
  });

  // Supprimer
  card.querySelector('.deleteBtn').addEventListener('click', (e)=>{
    e.stopPropagation();
    gallery.removeChild(card);
    savedFiles = savedFiles.filter(f => f!==fileData);
    localStorage.setItem('myGallery', JSON.stringify(savedFiles));
  });

  // Agrandir
  card.addEventListener('click', ()=>{
    modalContent.innerHTML = "";
    if(fileData.type.startsWith("image/")) {
      const img = document.createElement('img');
      img.src = fileData.data;
      modalContent.appendChild(img);
    } else if(fileData.type.startsWith("video/")) {
      const vid = document.createElement('video');
      vid.src = fileData.data;
      vid.controls = true;
      vid.autoplay = true;
      modalContent.appendChild(vid);
    }
    modal.style.display='flex';
  });

  gallery.appendChild(card);
}

// Recherche
searchInput.addEventListener('input', ()=>{
  const query = searchInput.value.toLowerCase();
  document.querySelectorAll('.fileCard').forEach(card=>{
    const name = card.querySelector('.fileName').textContent.toLowerCase();
    card.style.display = name.includes(query) ? 'block' : 'none';
  });
});

closeModal.addEventListener('click', ()=>modal.style.display='none');
modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });

clearBtn.addEventListener('click', ()=>{
  if(confirm("Veux-tu vraiment supprimer toute la galerie ?")){
    savedFiles = [];
    localStorage.removeItem('myGallery');
    gallery.innerHTML = "";
  }
});
</script>









